{"version":3,"sources":["ProgressTimeout.js"],"names":["ProgressTimeout","timeout","timeoutHandler","_timeout","_onTimedOut","_isDone","_aliveTimer","bind","progress","clearTimeout","setTimeout","done","module","exports"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;IACMA,e;AACJ,2BAAaC,OAAb,EAAsBC,cAAtB,EAAsC;AACpC,SAAKC,QAAL,GAAgBF,OAAhB;AACA,SAAKG,WAAL,GAAmBF,cAAnB;AACA,SAAKG,OAAL,GAAe,KAAf;AACA,SAAKC,WAAL,GAAmB,IAAnB;AACA,SAAKF,WAAL,GAAmB,KAAKA,WAAL,CAAiBG,IAAjB,CAAsB,IAAtB,CAAnB;AACD;;;;SAEDC,Q,GAAA,oBAAY;AACV;AACA;AACA;AACA,QAAI,KAAKH,OAAT,EAAkB;;AAElB,QAAI,KAAKF,QAAL,GAAgB,CAApB,EAAuB;AACrB,UAAI,KAAKG,WAAT,EAAsBG,YAAY,CAAC,KAAKH,WAAN,CAAZ;AACtB,WAAKA,WAAL,GAAmBI,UAAU,CAAC,KAAKN,WAAN,EAAmB,KAAKD,QAAxB,CAA7B;AACD;AACF,G;;SAEDQ,I,GAAA,gBAAQ;AACN,QAAI,KAAKL,WAAT,EAAsB;AACpBG,MAAAA,YAAY,CAAC,KAAKH,WAAN,CAAZ;AACA,WAAKA,WAAL,GAAmB,IAAnB;AACD;;AACD,SAAKD,OAAL,GAAe,IAAf;AACD,G;;;;;AAGHO,MAAM,CAACC,OAAP,GAAiBb,eAAjB","sourcesContent":["/**\n * Helper to abort upload requests if there has not been any progress for `timeout` ms.\n * Create an instance using `timer = new ProgressTimeout(10000, onTimeout)`\n * Call `timer.progress()` to signal that there has been progress of any kind.\n * Call `timer.done()` when the upload has completed.\n */\nclass ProgressTimeout {\n  constructor (timeout, timeoutHandler) {\n    this._timeout = timeout\n    this._onTimedOut = timeoutHandler\n    this._isDone = false\n    this._aliveTimer = null\n    this._onTimedOut = this._onTimedOut.bind(this)\n  }\n\n  progress () {\n    // Some browsers fire another progress event when the upload is\n    // cancelled, so we have to ignore progress after the timer was\n    // told to stop.\n    if (this._isDone) return\n\n    if (this._timeout > 0) {\n      if (this._aliveTimer) clearTimeout(this._aliveTimer)\n      this._aliveTimer = setTimeout(this._onTimedOut, this._timeout)\n    }\n  }\n\n  done () {\n    if (this._aliveTimer) {\n      clearTimeout(this._aliveTimer)\n      this._aliveTimer = null\n    }\n    this._isDone = true\n  }\n}\n\nmodule.exports = ProgressTimeout\n"]}