{"version":3,"sources":["VirtualList.js"],"names":["require","h","Component","STYLE_INNER","position","width","minHeight","STYLE_CONTENT","top","left","overflow","VirtualList","props","handleResize","resize","handleScroll","setState","offset","base","scrollTop","sync","forceUpdate","focusElement","state","height","offsetHeight","componentWillUpdate","contains","document","activeElement","componentDidUpdate","parentNode","focus","componentDidMount","window","addEventListener","componentWillUnmount","removeEventListener","render","data","rowHeight","renderRow","overscanCount","start","Math","floor","visibleRowCount","max","end","selection","slice","styleInner","length","styleContent","map","module","exports"],"mappings":"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","sourcesContent":["/**\n * Adapted from preact-virtual-list: https://github.com/developit/preact-virtual-list\n *\n * Â© 2016 Jason Miller\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n *\n * Adaptations:\n * - Added role=presentation to helper elements\n * - Tweaked styles for Uppy's Dashboard use case\n */\n\nconst { h, Component } = require('preact')\n\nconst STYLE_INNER = {\n  position: 'relative',\n  // Disabled for our use case: the wrapper elements around FileList already deal with overflow,\n  // and this additional property would hide things that we want to show.\n  //\n  // overflow: 'hidden',\n  width: '100%',\n  minHeight: '100%',\n}\n\nconst STYLE_CONTENT = {\n  position: 'absolute',\n  top: 0,\n  left: 0,\n  // Because the `top` value gets set to some offset, this `height` being 100% would make the scrollbar\n  // stretch far beyond the content. For our use case, the content div actually can get its height from\n  // the elements inside it, so we don't need to specify a `height` property at all.\n  //\n  // height: '100%',\n  width: '100%',\n  overflow: 'visible',\n}\n\nclass VirtualList extends Component {\n  constructor (props) {\n    super(props)\n\n    // The currently focused node, used to retain focus when the visible rows change.\n    // To avoid update loops, this should not cause state updates, so it's kept as a plain property.\n    this.focusElement = null\n\n    this.state = {\n      offset: 0,\n      height: 0,\n    }\n  }\n\n  resize () {\n    if (this.state.height !== this.base.offsetHeight) {\n      this.setState({\n        height: this.base.offsetHeight,\n      })\n    }\n  }\n\n  handleResize = () => {\n    this.resize()\n  }\n\n  handleScroll = () => {\n    this.setState({\n      offset: this.base.scrollTop,\n    })\n    if (this.props.sync) {\n      this.forceUpdate()\n    }\n  }\n\n  componentWillUpdate () {\n    if (this.base.contains(document.activeElement)) {\n      this.focusElement = document.activeElement\n    }\n  }\n\n  componentDidUpdate () {\n    // Maintain focus when rows are added and removed.\n    if (this.focusElement && this.focusElement.parentNode\n        && document.activeElement !== this.focusElement) {\n      this.focusElement.focus()\n    }\n    this.focusElement = null\n    this.resize()\n  }\n\n  componentDidMount () {\n    this.resize()\n    window.addEventListener('resize', this.handleResize)\n  }\n\n  componentWillUnmount () {\n    window.removeEventListener('resize', this.handleResize)\n  }\n\n  render ({\n    data,\n    rowHeight,\n    renderRow,\n    overscanCount = 10,\n    sync,\n    ...props\n  }) {\n    const { offset, height } = this.state\n    // first visible row index\n    let start = Math.floor(offset / rowHeight)\n\n    // actual number of visible rows (without overscan)\n    let visibleRowCount = Math.floor(height / rowHeight)\n\n    // Overscan: render blocks of rows modulo an overscan row count\n    // This dramatically reduces DOM writes during scrolling\n    if (overscanCount) {\n      start = Math.max(0, start - (start % overscanCount))\n      visibleRowCount += overscanCount\n    }\n\n    // last visible + overscan row index + padding to allow keyboard focus to travel past the visible area\n    const end = start + visibleRowCount + 4\n\n    // data slice currently in viewport plus overscan items\n    const selection = data.slice(start, end)\n\n    const styleInner = { ...STYLE_INNER, height: data.length * rowHeight }\n    const styleContent = { ...STYLE_CONTENT, top: start * rowHeight }\n\n    // The `role=\"presentation\"` attributes ensure that these wrapper elements are not treated as list\n    // items by accessibility and outline tools.\n    return (\n      <div onScroll={this.handleScroll} {...props}>\n        <div role=\"presentation\" style={styleInner}>\n          <div role=\"presentation\" style={styleContent}>\n            {selection.map(renderRow)}\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nmodule.exports = VirtualList\n"]}