{"version":3,"sources":["index.js"],"names":["require","Plugin","getDroppedFiles","toArray","module","exports","uppy","opts","addFiles","files","descriptors","map","file","source","id","name","type","data","meta","relativePath","err","log","handleDrop","event","preventDefault","stopPropagation","clearTimeout","removeDragOverClassTimeout","currentTarget","classList","remove","setPluginState","isDraggingOver","logDropError","error","dataTransfer","then","handleDragOver","dropEffect","add","handleDragLeave","setTimeout","addListeners","target","Element","nodes","document","querySelectorAll","length","Error","forEach","node","addEventListener","removeListeners","removeEventListener","title","defaultOpts","install","uninstall","VERSION"],"mappings":"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","sourcesContent":["const { Plugin } = require('@uppy/core')\nconst getDroppedFiles = require('@uppy/utils/lib/getDroppedFiles')\nconst toArray = require('@uppy/utils/lib/toArray')\n\n/**\n * Drop Target plugin\n *\n */\nmodule.exports = class DropTarget extends Plugin {\n  static VERSION = require('../package.json').version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'DropTarget'\n    this.title = 'Drop Target'\n\n    // Default options\n    const defaultOpts = {\n      target: null,\n    }\n\n    // Merge default options with the ones set by user\n    this.opts = { ...defaultOpts, ...opts }\n    this.removeDragOverClassTimeout = null\n  }\n\n  addFiles = (files) => {\n    const descriptors = files.map((file) => ({\n      source: this.id,\n      name: file.name,\n      type: file.type,\n      data: file,\n      meta: {\n        // path of the file relative to the ancestor directory the user selected.\n        // e.g. 'docs/Old Prague/airbnb.pdf'\n        relativePath: file.relativePath || null,\n      },\n    }))\n\n    try {\n      this.uppy.addFiles(descriptors)\n    } catch (err) {\n      this.uppy.log(err)\n    }\n  }\n\n  handleDrop = (event) => {\n    event.preventDefault()\n    event.stopPropagation()\n    clearTimeout(this.removeDragOverClassTimeout)\n\n    // 2. Remove dragover class\n    event.currentTarget.classList.remove('uppy-is-drag-over')\n    this.setPluginState({ isDraggingOver: false })\n\n    // 3. Add all dropped files\n    this.uppy.log('[DropTarget] Files were dropped')\n    const logDropError = (error) => {\n      this.uppy.log(error, 'error')\n    }\n    getDroppedFiles(event.dataTransfer, { logDropError })\n      .then((files) => this.addFiles(files))\n  }\n\n  handleDragOver = (event) => {\n    event.preventDefault()\n    event.stopPropagation()\n\n    // 1. Add a small (+) icon on drop\n    // (and prevent browsers from interpreting this as files being _moved_ into the browser,\n    // https://github.com/transloadit/uppy/issues/1978)\n    event.dataTransfer.dropEffect = 'copy'\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    event.currentTarget.classList.add('uppy-is-drag-over')\n    this.setPluginState({ isDraggingOver: true })\n  }\n\n  handleDragLeave = (event) => {\n    event.preventDefault()\n    event.stopPropagation()\n\n    const { currentTarget } = event\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    // Timeout against flickering, this solution is taken from drag-drop library.\n    // Solution with 'pointer-events: none' didn't work across browsers.\n    this.removeDragOverClassTimeout = setTimeout(() => {\n      currentTarget.classList.remove('uppy-is-drag-over')\n      this.setPluginState({ isDraggingOver: false })\n    }, 50)\n  }\n\n  addListeners = () => {\n    const { target } = this.opts\n\n    if (target instanceof Element) {\n      this.nodes = [target]\n    } else if (typeof target === 'string') {\n      this.nodes = toArray(document.querySelectorAll(target))\n    }\n\n    if (!this.nodes && !this.nodes.length > 0) {\n      throw new Error(`\"${target}\" does not match any HTML elements`)\n    }\n\n    this.nodes.forEach((node) => {\n      node.addEventListener('dragover', this.handleDragOver, false)\n      node.addEventListener('dragleave', this.handleDragLeave, false)\n      node.addEventListener('drop', this.handleDrop, false)\n    })\n  }\n\n  removeListeners = () => {\n    if (this.nodes) {\n      this.nodes.forEach((node) => {\n        node.removeEventListener('dragover', this.handleDragOver, false)\n        node.removeEventListener('dragleave', this.handleDragLeave, false)\n        node.removeEventListener('drop', this.handleDrop, false)\n      })\n    }\n  }\n\n  install () {\n    this.setPluginState({ isDraggingOver: false })\n    this.addListeners()\n  }\n\n  uninstall () {\n    this.removeListeners()\n  }\n}\n"]}