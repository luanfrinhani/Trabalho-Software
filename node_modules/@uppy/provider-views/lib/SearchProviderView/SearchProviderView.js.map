{"version":3,"sources":["SearchProviderView.js"],"names":["require","h","SearchInput","Browser","LoaderView","generateFileID","getFileType","isPreviewSupported","Header","SharedHandler","CloseWrapper","module","exports","plugin","opts","provider","_sharedHandler","defaultOptions","viewType","showTitles","showFilter","showBreadcrumbs","search","bind","triggerSearchInput","addFile","preFirstRender","handleError","handleScroll","donePicking","cancelPicking","clearSelection","render","setPluginState","isInputMode","files","folders","directories","filterInput","isSearchVisible","tearDown","_updateFilesAndInputMode","res","nextPageQuery","_searchTerm","searchedFor","items","forEach","item","push","didFirstRender","onFirstRender","query","loaderWrapper","file","tagFile","id","providerFileToId","source","data","name","type","mimeType","isRemote","body","fileId","remote","companionUrl","url","fileUrl","requestPath","providerOptions","fileType","preview","thumbnail","uppy","log","err","isRestriction","error","toString","message","i18n","info","details","e","scrollPos","target","scrollHeight","scrollTop","offsetHeight","_isHandlingScroll","then","getPluginState","catch","currentSelection","promises","map","Promise","all","dashboard","getPlugin","hideAllPanels","state","viewOptions","loading","targetViewOptions","browserProps","isChecked","toggleCheckbox","done","cancel","headerComponent","title","pluginIcon","icon","uppyFiles","getFiles","validateRestrictions","VERSION"],"mappings":"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","sourcesContent":["const { h } = require('preact')\nconst SearchInput = require('./InputView')\nconst Browser = require('../Browser')\nconst LoaderView = require('../Loader')\nconst generateFileID = require('@uppy/utils/lib/generateFileID')\nconst getFileType = require('@uppy/utils/lib/getFileType')\nconst isPreviewSupported = require('@uppy/utils/lib/isPreviewSupported')\nconst Header = require('./Header')\nconst SharedHandler = require('../SharedHandler')\nconst CloseWrapper = require('../CloseWrapper')\n\n/**\n * Class to easily generate generic views for Provider plugins\n */\nmodule.exports = class ProviderView {\n  static VERSION = require('../../package.json').version\n\n  /**\n   * @param {object} plugin instance of the plugin\n   * @param {object} opts\n   */\n  constructor (plugin, opts) {\n    this.plugin = plugin\n    this.provider = opts.provider\n    this._sharedHandler = new SharedHandler(plugin)\n\n    // set default options\n    const defaultOptions = {\n      viewType: 'grid',\n      showTitles: false,\n      showFilter: false,\n      showBreadcrumbs: false,\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    // Logic\n    this.search = this.search.bind(this)\n    this.triggerSearchInput = this.triggerSearchInput.bind(this)\n    this.addFile = this.addFile.bind(this)\n    this.preFirstRender = this.preFirstRender.bind(this)\n    this.handleError = this.handleError.bind(this)\n    this.handleScroll = this.handleScroll.bind(this)\n    this.donePicking = this.donePicking.bind(this)\n    this.cancelPicking = this.cancelPicking.bind(this)\n    this.clearSelection = this.clearSelection.bind(this)\n\n    // Visual\n    this.render = this.render.bind(this)\n\n    this.clearSelection()\n\n    // Set default state for the plugin\n    this.plugin.setPluginState({\n      isInputMode: true,\n      files: [],\n      folders: [],\n      directories: [],\n      filterInput: '',\n      isSearchVisible: false,\n    })\n  }\n\n  tearDown () {\n    // Nothing.\n  }\n\n  _updateFilesAndInputMode (res, files) {\n    this.nextPageQuery = res.nextPageQuery\n    this._searchTerm = res.searchedFor\n    res.items.forEach((item) => { files.push(item) })\n    this.plugin.setPluginState({ isInputMode: false, files })\n  }\n\n  /**\n   * Called only the first time the provider view is rendered.\n   * Kind of like an init function.\n   */\n  preFirstRender () {\n    this.plugin.setPluginState({ didFirstRender: true })\n    this.plugin.onFirstRender()\n  }\n\n  search (query) {\n    if (query && query === this._searchTerm) {\n      // no need to search again as this is the same as the previous search\n      this.plugin.setPluginState({ isInputMode: false })\n      return\n    }\n\n    return this._sharedHandler.loaderWrapper(\n      this.provider.search(query),\n      (res) => {\n        this._updateFilesAndInputMode(res, [])\n      },\n      this.handleError\n    )\n  }\n\n  triggerSearchInput () {\n    this.plugin.setPluginState({ isInputMode: true })\n  }\n\n  // @todo this function should really be a function of the plugin and not the view.\n  // maybe we should consider creating a base ProviderPlugin class that has this method\n  addFile (file) {\n    const tagFile = {\n      id: this.providerFileToId(file),\n      source: this.plugin.id,\n      data: file,\n      name: file.name || file.id,\n      type: file.mimeType,\n      isRemote: true,\n      body: {\n        fileId: file.id,\n      },\n      remote: {\n        companionUrl: this.plugin.opts.companionUrl,\n        url: `${this.provider.fileUrl(file.requestPath)}`,\n        body: {\n          fileId: file.id,\n        },\n        providerOptions: { ...this.provider.opts, provider: null },\n      },\n    }\n\n    const fileType = getFileType(tagFile)\n    // TODO Should we just always use the thumbnail URL if it exists?\n    if (fileType && isPreviewSupported(fileType)) {\n      tagFile.preview = file.thumbnail\n    }\n    this.plugin.uppy.log('Adding remote file')\n    try {\n      this.plugin.uppy.addFile(tagFile)\n    } catch (err) {\n      if (!err.isRestriction) {\n        this.plugin.uppy.log(err)\n      }\n    }\n  }\n\n  providerFileToId (file) {\n    return generateFileID({\n      data: file,\n      name: file.name || file.id,\n      type: file.mimeType,\n    })\n  }\n\n  handleError (error) {\n    const uppy = this.plugin.uppy\n    uppy.log(error.toString())\n    const message = uppy.i18n('companionError')\n    uppy.info({ message, details: error.toString() }, 'error', 5000)\n  }\n\n  handleScroll (e) {\n    const scrollPos = e.target.scrollHeight - (e.target.scrollTop + e.target.offsetHeight)\n    const query = this.nextPageQuery || null\n\n    if (scrollPos < 50 && query && !this._isHandlingScroll) {\n      this.provider.search(this._searchTerm, query)\n        .then((res) => {\n          const { files } = this.plugin.getPluginState()\n          this._updateFilesAndInputMode(res, files)\n        }).catch(this.handleError)\n        .then(() => { this._isHandlingScroll = false }) // always called\n\n      this._isHandlingScroll = true\n    }\n  }\n\n  donePicking () {\n    const { currentSelection } = this.plugin.getPluginState()\n    const promises = currentSelection.map((file) => this.addFile(file))\n\n    this._sharedHandler.loaderWrapper(Promise.all(promises), () => {\n      this.clearSelection()\n    }, () => {})\n  }\n\n  cancelPicking () {\n    this.clearSelection()\n\n    const dashboard = this.plugin.uppy.getPlugin('Dashboard')\n    if (dashboard) dashboard.hideAllPanels()\n  }\n\n  clearSelection () {\n    this.plugin.setPluginState({ currentSelection: [] })\n  }\n\n  render (state, viewOptions = {}) {\n    const { didFirstRender, isInputMode } = this.plugin.getPluginState()\n    if (!didFirstRender) {\n      this.preFirstRender()\n    }\n\n    // reload pluginState for \"loading\" attribute because it might\n    // have changed above.\n    if (this.plugin.getPluginState().loading) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <LoaderView i18n={this.plugin.uppy.i18n} />\n        </CloseWrapper>\n      )\n    }\n\n    if (isInputMode) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <SearchInput\n            search={this.search}\n            i18n={this.plugin.uppy.i18n}\n          />\n        </CloseWrapper>\n      )\n    }\n\n    const targetViewOptions = { ...this.opts, ...viewOptions }\n    const browserProps = {\n      ...this.plugin.getPluginState(),\n      isChecked: this._sharedHandler.isChecked,\n      toggleCheckbox: this._sharedHandler.toggleCheckbox,\n      handleScroll: this.handleScroll,\n      done: this.donePicking,\n      cancel: this.cancelPicking,\n      headerComponent: Header({\n        triggerSearchInput: this.triggerSearchInput,\n        i18n: this.plugin.uppy.i18n,\n      }),\n      title: this.plugin.title,\n      viewType: targetViewOptions.viewType,\n      showTitles: targetViewOptions.showTitles,\n      showFilter: targetViewOptions.showFilter,\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      pluginIcon: this.plugin.icon,\n      i18n: this.plugin.uppy.i18n,\n      uppyFiles: this.plugin.uppy.getFiles(),\n      validateRestrictions: this.plugin.uppy.validateRestrictions,\n    }\n\n    return (\n      <CloseWrapper onUnmount={this.clearSelection}>\n        <Browser {...browserProps} />\n      </CloseWrapper>\n    )\n  }\n}\n"]}