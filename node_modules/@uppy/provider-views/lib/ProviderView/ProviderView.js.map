{"version":3,"sources":["ProviderView.js"],"names":["require","h","AuthView","Header","Browser","LoaderView","generateFileID","getFileType","findIndex","isPreviewSupported","SharedHandler","CloseWrapper","getOrigin","location","origin","protocol","hostname","port","module","exports","plugin","opts","provider","_sharedHandler","defaultOptions","viewType","showTitles","showFilter","showBreadcrumbs","addFile","bind","filterQuery","getFolder","getNextFolder","logout","preFirstRender","handleAuth","sortByTitle","sortByDate","handleError","handleScroll","listAllFiles","donePicking","cancelPicking","clearSelection","render","setPluginState","authenticated","files","folders","directories","filterInput","isSearchVisible","tearDown","_updateFilesAndFolders","res","nextPagePath","items","forEach","item","isFolder","push","didFirstRender","onFirstRender","id","name","loaderWrapper","list","updatedDirectories","state","getPluginState","index","dir","slice","concat","title","username","folder","requestPath","lastCheckbox","undefined","file","tagFile","providerFileToId","source","data","type","mimeType","isRemote","body","fileId","remote","companionUrl","url","fileUrl","providerOptions","fileType","preview","thumbnail","uppy","log","err","isRestriction","then","ok","revoked","message","i18n","manual_revoke_url","info","newState","catch","e","target","value","sorting","sortedFiles","sort","fileA","fileB","localeCompare","sortedFolders","folderA","folderB","a","Date","modifiedDate","b","sortBySize","length","getItemData","size","addFolder","folderId","selectedFolders","loading","count","success","ids","map","smart_count","authState","btoa","JSON","stringify","clientVersion","ProviderView","VERSION","link","authUrl","uppyVersions","authWindow","window","open","handleToken","_isOriginAllowed","companionAllowedHosts","parse","token","close","removeEventListener","setAuthToken","addEventListener","allowedOrigin","getRegex","RegExp","patterns","Array","isArray","filter","pattern","some","test","error","toString","isAuthError","details","scrollPos","scrollHeight","scrollTop","offsetHeight","path","_isHandlingScroll","Promise","resolve","reject","moreFiles","currentSelection","promises","all","dashboard","getPlugin","hideAllPanels","viewOptions","icon","i18nArray","targetViewOptions","headerProps","pluginIcon","browserProps","filterItems","isChecked","toggleCheckbox","done","cancel","headerComponent","uppyFiles","getFiles","validateRestrictions"],"mappings":";;;;eAAcA,OAAO,CAAC,QAAD,C;IAAbC,C,YAAAA,C;;AACR,IAAMC,QAAQ,GAAGF,OAAO,CAAC,YAAD,CAAxB;;AACA,IAAMG,MAAM,GAAGH,OAAO,CAAC,UAAD,CAAtB;;AACA,IAAMI,OAAO,GAAGJ,OAAO,CAAC,YAAD,CAAvB;;AACA,IAAMK,UAAU,GAAGL,OAAO,CAAC,WAAD,CAA1B;;AACA,IAAMM,cAAc,GAAGN,OAAO,CAAC,gCAAD,CAA9B;;AACA,IAAMO,WAAW,GAAGP,OAAO,CAAC,6BAAD,CAA3B;;AACA,IAAMQ,SAAS,GAAGR,OAAO,CAAC,2BAAD,CAAzB;;AACA,IAAMS,kBAAkB,GAAGT,OAAO,CAAC,oCAAD,CAAlC;;AACA,IAAMU,aAAa,GAAGV,OAAO,CAAC,kBAAD,CAA7B;;AACA,IAAMW,YAAY,GAAGX,OAAO,CAAC,iBAAD,CAA5B,C,CAEA;;;AACA,SAASY,SAAT,GAAsB;AACpB,MAAI,YAAYC,QAAhB,EAA0B;AACxB,WAAOA,QAAQ,CAACC,MAAhB,CADwB,CACD;AACxB;;AACD,SAAUD,QAAQ,CAACE,QAAnB,UAAgCF,QAAQ,CAACG,QAAzC,IAAoDH,QAAQ,CAACI,IAAT,SAAoBJ,QAAQ,CAACI,IAA7B,GAAsC,EAA1F;AACD;AAED;AACA;AACA;;;AACAC,MAAM,CAACC,OAAP;AAGE;AACF;AACA;AACA;AACE,wBAAaC,MAAb,EAAqBC,IAArB,EAA2B;AACzB,SAAKD,MAAL,GAAcA,MAAd;AACA,SAAKE,QAAL,GAAgBD,IAAI,CAACC,QAArB;AACA,SAAKC,cAAL,GAAsB,IAAIb,aAAJ,CAAkBU,MAAlB,CAAtB,CAHyB,CAKzB;;AACA,QAAMI,cAAc,GAAG;AACrBC,MAAAA,QAAQ,EAAE,MADW;AAErBC,MAAAA,UAAU,EAAE,IAFS;AAGrBC,MAAAA,UAAU,EAAE,IAHS;AAIrBC,MAAAA,eAAe,EAAE;AAJI,KAAvB,CANyB,CAazB;;AACA,SAAKP,IAAL,gBAAiBG,cAAjB,EAAoCH,IAApC,EAdyB,CAgBzB;;AACA,SAAKQ,OAAL,GAAe,KAAKA,OAAL,CAAaC,IAAb,CAAkB,IAAlB,CAAf;AACA,SAAKC,WAAL,GAAmB,KAAKA,WAAL,CAAiBD,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAKE,SAAL,GAAiB,KAAKA,SAAL,CAAeF,IAAf,CAAoB,IAApB,CAAjB;AACA,SAAKG,aAAL,GAAqB,KAAKA,aAAL,CAAmBH,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKI,MAAL,GAAc,KAAKA,MAAL,CAAYJ,IAAZ,CAAiB,IAAjB,CAAd;AACA,SAAKK,cAAL,GAAsB,KAAKA,cAAL,CAAoBL,IAApB,CAAyB,IAAzB,CAAtB;AACA,SAAKM,UAAL,GAAkB,KAAKA,UAAL,CAAgBN,IAAhB,CAAqB,IAArB,CAAlB;AACA,SAAKO,WAAL,GAAmB,KAAKA,WAAL,CAAiBP,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAKQ,UAAL,GAAkB,KAAKA,UAAL,CAAgBR,IAAhB,CAAqB,IAArB,CAAlB;AACA,SAAKS,WAAL,GAAmB,KAAKA,WAAL,CAAiBT,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAKU,YAAL,GAAoB,KAAKA,YAAL,CAAkBV,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAKW,YAAL,GAAoB,KAAKA,YAAL,CAAkBX,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAKY,WAAL,GAAmB,KAAKA,WAAL,CAAiBZ,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAKa,aAAL,GAAqB,KAAKA,aAAL,CAAmBb,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKc,cAAL,GAAsB,KAAKA,cAAL,CAAoBd,IAApB,CAAyB,IAAzB,CAAtB,CA/ByB,CAiCzB;;AACA,SAAKe,MAAL,GAAc,KAAKA,MAAL,CAAYf,IAAZ,CAAiB,IAAjB,CAAd;AAEA,SAAKc,cAAL,GApCyB,CAsCzB;;AACA,SAAKxB,MAAL,CAAY0B,cAAZ,CAA2B;AACzBC,MAAAA,aAAa,EAAE,KADU;AAEzBC,MAAAA,KAAK,EAAE,EAFkB;AAGzBC,MAAAA,OAAO,EAAE,EAHgB;AAIzBC,MAAAA,WAAW,EAAE,EAJY;AAKzBC,MAAAA,WAAW,EAAE,EALY;AAMzBC,MAAAA,eAAe,EAAE;AANQ,KAA3B;AAQD;;AAtDH;;AAAA,SAwDEC,QAxDF,GAwDE,oBAAY,CACV;AACD,GA1DH;;AAAA,SA4DEC,sBA5DF,GA4DE,gCAAwBC,GAAxB,EAA6BP,KAA7B,EAAoCC,OAApC,EAA6C;AAC3C,SAAKO,YAAL,GAAoBD,GAAG,CAACC,YAAxB;AACAD,IAAAA,GAAG,CAACE,KAAJ,CAAUC,OAAV,CAAkB,UAACC,IAAD,EAAU;AAC1B,UAAIA,IAAI,CAACC,QAAT,EAAmB;AACjBX,QAAAA,OAAO,CAACY,IAAR,CAAaF,IAAb;AACD,OAFD,MAEO;AACLX,QAAAA,KAAK,CAACa,IAAN,CAAWF,IAAX;AACD;AACF,KAND;AAQA,SAAKvC,MAAL,CAAY0B,cAAZ,CAA2B;AAAEG,MAAAA,OAAO,EAAPA,OAAF;AAAWD,MAAAA,KAAK,EAALA;AAAX,KAA3B;AACD;AAED;AACF;AACA;AACA;AA5EA;;AAAA,SA6EEb,cA7EF,GA6EE,0BAAkB;AAChB,SAAKf,MAAL,CAAY0B,cAAZ,CAA2B;AAAEgB,MAAAA,cAAc,EAAE;AAAlB,KAA3B;AACA,SAAK1C,MAAL,CAAY2C,aAAZ;AACD;AAED;AACF;AACA;AACA;AACA;AACA;AAvFA;;AAAA,SAwFE/B,SAxFF,GAwFE,mBAAWgC,EAAX,EAAeC,IAAf,EAAqB;AAAA;;AACnB,WAAO,KAAK1C,cAAL,CAAoB2C,aAApB,CACL,KAAK5C,QAAL,CAAc6C,IAAd,CAAmBH,EAAnB,CADK,EAEL,UAACT,GAAD,EAAS;AACP,UAAMN,OAAO,GAAG,EAAhB;AACA,UAAMD,KAAK,GAAG,EAAd;AACA,UAAIoB,kBAAJ;;AAEA,UAAMC,KAAK,GAAG,KAAI,CAACjD,MAAL,CAAYkD,cAAZ,EAAd;;AACA,UAAMC,KAAK,GAAG/D,SAAS,CAAC6D,KAAK,CAACnB,WAAP,EAAoB,UAACsB,GAAD;AAAA,eAASR,EAAE,KAAKQ,GAAG,CAACR,EAApB;AAAA,OAApB,CAAvB;;AAEA,UAAIO,KAAK,KAAK,CAAC,CAAf,EAAkB;AAChBH,QAAAA,kBAAkB,GAAGC,KAAK,CAACnB,WAAN,CAAkBuB,KAAlB,CAAwB,CAAxB,EAA2BF,KAAK,GAAG,CAAnC,CAArB;AACD,OAFD,MAEO;AACLH,QAAAA,kBAAkB,GAAGC,KAAK,CAACnB,WAAN,CAAkBwB,MAAlB,CAAyB,CAAC;AAAEV,UAAAA,EAAE,EAAFA,EAAF;AAAMW,UAAAA,KAAK,EAAEV;AAAb,SAAD,CAAzB,CAArB;AACD;;AAED,MAAA,KAAI,CAACW,QAAL,GAAgBrB,GAAG,CAACqB,QAAJ,IAAgB,KAAI,CAACA,QAArC;;AACA,MAAA,KAAI,CAACtB,sBAAL,CAA4BC,GAA5B,EAAiCP,KAAjC,EAAwCC,OAAxC;;AACA,MAAA,KAAI,CAAC7B,MAAL,CAAY0B,cAAZ,CAA2B;AAAEI,QAAAA,WAAW,EAAEkB;AAAf,OAA3B;AACD,KAnBI,EAoBL,KAAK7B,WApBA,CAAP;AAsBD;AAED;AACF;AACA;AACA;AACA;AArHA;;AAAA,SAsHEN,aAtHF,GAsHE,uBAAe4C,MAAf,EAAuB;AACrB,SAAK7C,SAAL,CAAe6C,MAAM,CAACC,WAAtB,EAAmCD,MAAM,CAACZ,IAA1C;AACA,SAAKc,YAAL,GAAoBC,SAApB;AACD,GAzHH;;AAAA,SA2HEnD,OA3HF,GA2HE,iBAASoD,IAAT,EAAe;AACb,QAAMC,OAAO,GAAG;AACdlB,MAAAA,EAAE,EAAE,KAAKmB,gBAAL,CAAsBF,IAAtB,CADU;AAEdG,MAAAA,MAAM,EAAE,KAAKhE,MAAL,CAAY4C,EAFN;AAGdqB,MAAAA,IAAI,EAAEJ,IAHQ;AAIdhB,MAAAA,IAAI,EAAEgB,IAAI,CAAChB,IAAL,IAAagB,IAAI,CAACjB,EAJV;AAKdsB,MAAAA,IAAI,EAAEL,IAAI,CAACM,QALG;AAMdC,MAAAA,QAAQ,EAAE,IANI;AAOdC,MAAAA,IAAI,EAAE;AACJC,QAAAA,MAAM,EAAET,IAAI,CAACjB;AADT,OAPQ;AAUd2B,MAAAA,MAAM,EAAE;AACNC,QAAAA,YAAY,EAAE,KAAKxE,MAAL,CAAYC,IAAZ,CAAiBuE,YADzB;AAENC,QAAAA,GAAG,OAAK,KAAKvE,QAAL,CAAcwE,OAAd,CAAsBb,IAAI,CAACH,WAA3B,CAFF;AAGNW,QAAAA,IAAI,EAAE;AACJC,UAAAA,MAAM,EAAET,IAAI,CAACjB;AADT,SAHA;AAMN+B,QAAAA,eAAe,EAAE,KAAKzE,QAAL,CAAcD;AANzB;AAVM,KAAhB;AAoBA,QAAM2E,QAAQ,GAAGzF,WAAW,CAAC2E,OAAD,CAA5B,CArBa,CAsBb;;AACA,QAAIc,QAAQ,IAAIvF,kBAAkB,CAACuF,QAAD,CAAlC,EAA8C;AAC5Cd,MAAAA,OAAO,CAACe,OAAR,GAAkBhB,IAAI,CAACiB,SAAvB;AACD;;AACD,SAAK9E,MAAL,CAAY+E,IAAZ,CAAiBC,GAAjB,CAAqB,oBAArB;;AACA,QAAI;AACF,WAAKhF,MAAL,CAAY+E,IAAZ,CAAiBtE,OAAjB,CAAyBqD,OAAzB;AACA,aAAO,IAAP;AACD,KAHD,CAGE,OAAOmB,GAAP,EAAY;AACZ,UAAI,CAACA,GAAG,CAACC,aAAT,EAAwB;AACtB,aAAKlF,MAAL,CAAY+E,IAAZ,CAAiBC,GAAjB,CAAqBC,GAArB;AACD;;AACD,aAAO,KAAP;AACD;AACF;AAED;AACF;AACA;AAnKA;;AAAA,SAoKEnE,MApKF,GAoKE,kBAAU;AAAA;;AACR,SAAKZ,QAAL,CAAcY,MAAd,GACGqE,IADH,CACQ,UAAChD,GAAD,EAAS;AACb,UAAIA,GAAG,CAACiD,EAAR,EAAY;AACV,YAAI,CAACjD,GAAG,CAACkD,OAAT,EAAkB;AAChB,cAAMC,OAAO,GAAG,MAAI,CAACtF,MAAL,CAAY+E,IAAZ,CAAiBQ,IAAjB,CAAsB,0BAAtB,EAAkD;AAChErF,YAAAA,QAAQ,EAAE,MAAI,CAACF,MAAL,CAAYuD,KAD0C;AAEhEkB,YAAAA,GAAG,EAAEtC,GAAG,CAACqD;AAFuD,WAAlD,CAAhB;;AAIA,UAAA,MAAI,CAACxF,MAAL,CAAY+E,IAAZ,CAAiBU,IAAjB,CAAsBH,OAAtB,EAA+B,MAA/B,EAAuC,IAAvC;AACD;;AAED,YAAMI,QAAQ,GAAG;AACf/D,UAAAA,aAAa,EAAE,KADA;AAEfC,UAAAA,KAAK,EAAE,EAFQ;AAGfC,UAAAA,OAAO,EAAE,EAHM;AAIfC,UAAAA,WAAW,EAAE;AAJE,SAAjB;;AAMA,QAAA,MAAI,CAAC9B,MAAL,CAAY0B,cAAZ,CAA2BgE,QAA3B;AACD;AACF,KAnBH,EAmBKC,KAnBL,CAmBW,KAAKxE,WAnBhB;AAoBD,GAzLH;;AAAA,SA2LER,WA3LF,GA2LE,qBAAaiF,CAAb,EAAgB;AACd,QAAM3C,KAAK,GAAG,KAAKjD,MAAL,CAAYkD,cAAZ,EAAd;AACA,SAAKlD,MAAL,CAAY0B,cAAZ,cAAgCuB,KAAhC;AAAuClB,MAAAA,WAAW,EAAE6D,CAAC,GAAGA,CAAC,CAACC,MAAF,CAASC,KAAZ,GAAoB;AAAzE;AACD,GA9LH;;AAAA,SAgME7E,WAhMF,GAgME,uBAAe;AACb,QAAMgC,KAAK,gBAAQ,KAAKjD,MAAL,CAAYkD,cAAZ,EAAR,CAAX;;AADa,QAELtB,KAFK,GAEuBqB,KAFvB,CAELrB,KAFK;AAAA,QAEEC,OAFF,GAEuBoB,KAFvB,CAEEpB,OAFF;AAAA,QAEWkE,OAFX,GAEuB9C,KAFvB,CAEW8C,OAFX;AAIb,QAAMC,WAAW,GAAGpE,KAAK,CAACqE,IAAN,CAAW,UAACC,KAAD,EAAQC,KAAR,EAAkB;AAC/C,UAAIJ,OAAO,KAAK,iBAAhB,EAAmC;AACjC,eAAOI,KAAK,CAACtD,IAAN,CAAWuD,aAAX,CAAyBF,KAAK,CAACrD,IAA/B,CAAP;AACD;;AACD,aAAOqD,KAAK,CAACrD,IAAN,CAAWuD,aAAX,CAAyBD,KAAK,CAACtD,IAA/B,CAAP;AACD,KALmB,CAApB;AAOA,QAAMwD,aAAa,GAAGxE,OAAO,CAACoE,IAAR,CAAa,UAACK,OAAD,EAAUC,OAAV,EAAsB;AACvD,UAAIR,OAAO,KAAK,iBAAhB,EAAmC;AACjC,eAAOQ,OAAO,CAAC1D,IAAR,CAAauD,aAAb,CAA2BE,OAAO,CAACzD,IAAnC,CAAP;AACD;;AACD,aAAOyD,OAAO,CAACzD,IAAR,CAAauD,aAAb,CAA2BG,OAAO,CAAC1D,IAAnC,CAAP;AACD,KALqB,CAAtB;AAOA,SAAK7C,MAAL,CAAY0B,cAAZ,cACKuB,KADL;AAEErB,MAAAA,KAAK,EAAEoE,WAFT;AAGEnE,MAAAA,OAAO,EAAEwE,aAHX;AAIEN,MAAAA,OAAO,EAAGA,OAAO,KAAK,iBAAb,GAAkC,gBAAlC,GAAqD;AAJhE;AAMD,GAxNH;;AAAA,SA0NE7E,UA1NF,GA0NE,sBAAc;AACZ,QAAM+B,KAAK,gBAAQ,KAAKjD,MAAL,CAAYkD,cAAZ,EAAR,CAAX;;AADY,QAEJtB,KAFI,GAEwBqB,KAFxB,CAEJrB,KAFI;AAAA,QAEGC,OAFH,GAEwBoB,KAFxB,CAEGpB,OAFH;AAAA,QAEYkE,OAFZ,GAEwB9C,KAFxB,CAEY8C,OAFZ;AAIZ,QAAMC,WAAW,GAAGpE,KAAK,CAACqE,IAAN,CAAW,UAACC,KAAD,EAAQC,KAAR,EAAkB;AAC/C,UAAMK,CAAC,GAAG,IAAIC,IAAJ,CAASP,KAAK,CAACQ,YAAf,CAAV;AACA,UAAMC,CAAC,GAAG,IAAIF,IAAJ,CAASN,KAAK,CAACO,YAAf,CAAV;;AAEA,UAAIX,OAAO,KAAK,gBAAhB,EAAkC;AAChC,eAAOS,CAAC,GAAGG,CAAJ,GAAQ,CAAC,CAAT,GAAaH,CAAC,GAAGG,CAAJ,GAAQ,CAAR,GAAY,CAAhC;AACD;;AACD,aAAOH,CAAC,GAAGG,CAAJ,GAAQ,CAAR,GAAYH,CAAC,GAAGG,CAAJ,GAAQ,CAAC,CAAT,GAAa,CAAhC;AACD,KARmB,CAApB;AAUA,QAAMN,aAAa,GAAGxE,OAAO,CAACoE,IAAR,CAAa,UAACK,OAAD,EAAUC,OAAV,EAAsB;AACvD,UAAMC,CAAC,GAAG,IAAIC,IAAJ,CAASH,OAAO,CAACI,YAAjB,CAAV;AACA,UAAMC,CAAC,GAAG,IAAIF,IAAJ,CAASF,OAAO,CAACG,YAAjB,CAAV;;AAEA,UAAIX,OAAO,KAAK,gBAAhB,EAAkC;AAChC,eAAOS,CAAC,GAAGG,CAAJ,GAAQ,CAAC,CAAT,GAAaH,CAAC,GAAGG,CAAJ,GAAQ,CAAR,GAAY,CAAhC;AACD;;AAED,aAAOH,CAAC,GAAGG,CAAJ,GAAQ,CAAR,GAAYH,CAAC,GAAGG,CAAJ,GAAQ,CAAC,CAAT,GAAa,CAAhC;AACD,KATqB,CAAtB;AAWA,SAAK3G,MAAL,CAAY0B,cAAZ,cACKuB,KADL;AAEErB,MAAAA,KAAK,EAAEoE,WAFT;AAGEnE,MAAAA,OAAO,EAAEwE,aAHX;AAIEN,MAAAA,OAAO,EAAGA,OAAO,KAAK,gBAAb,GAAiC,eAAjC,GAAmD;AAJ9D;AAMD,GAzPH;;AAAA,SA2PEa,UA3PF,GA2PE,sBAAc;AACZ,QAAM3D,KAAK,gBAAQ,KAAKjD,MAAL,CAAYkD,cAAZ,EAAR,CAAX;;AADY,QAEJtB,KAFI,GAEeqB,KAFf,CAEJrB,KAFI;AAAA,QAEGmE,OAFH,GAEe9C,KAFf,CAEG8C,OAFH,EAIZ;;AACA,QAAI,CAACnE,KAAK,CAACiF,MAAP,IAAiB,CAAC,KAAK7G,MAAL,CAAY8G,WAAZ,CAAwBlF,KAAK,CAAC,CAAD,CAA7B,EAAkCmF,IAAxD,EAA8D;AAC5D;AACD;;AAED,QAAMf,WAAW,GAAGpE,KAAK,CAACqE,IAAN,CAAW,UAACC,KAAD,EAAQC,KAAR,EAAkB;AAC/C,UAAMK,CAAC,GAAGN,KAAK,CAACa,IAAhB;AACA,UAAMJ,CAAC,GAAGR,KAAK,CAACY,IAAhB;;AAEA,UAAIhB,OAAO,KAAK,gBAAhB,EAAkC;AAChC,eAAOS,CAAC,GAAGG,CAAJ,GAAQ,CAAC,CAAT,GAAaH,CAAC,GAAGG,CAAJ,GAAQ,CAAR,GAAY,CAAhC;AACD;;AACD,aAAOH,CAAC,GAAGG,CAAJ,GAAQ,CAAR,GAAYH,CAAC,GAAGG,CAAJ,GAAQ,CAAC,CAAT,GAAa,CAAhC;AACD,KARmB,CAApB;AAUA,SAAK3G,MAAL,CAAY0B,cAAZ,cACKuB,KADL;AAEErB,MAAAA,KAAK,EAAEoE,WAFT;AAGED,MAAAA,OAAO,EAAGA,OAAO,KAAK,gBAAb,GAAiC,eAAjC,GAAmD;AAH9D;AAKD;AAED;AACF;AACA;AACA;AACA;AACA;AA1RA;;AAAA,SA2REiB,SA3RF,GA2RE,mBAAWvD,MAAX,EAAmB;AAAA;;AACjB,QAAMwD,QAAQ,GAAG,KAAKlD,gBAAL,CAAsBN,MAAtB,CAAjB;AACA,QAAMR,KAAK,GAAG,KAAKjD,MAAL,CAAYkD,cAAZ,EAAd;;AACA,QAAMrB,OAAO,gBAAQoB,KAAK,CAACiE,eAAd,CAAb;;AACA,QAAID,QAAQ,IAAIpF,OAAZ,IAAuBA,OAAO,CAACoF,QAAD,CAAP,CAAkBE,OAA7C,EAAsD;AACpD;AACD;;AACDtF,IAAAA,OAAO,CAACoF,QAAD,CAAP,GAAoB;AAAEE,MAAAA,OAAO,EAAE,IAAX;AAAiBvF,MAAAA,KAAK,EAAE;AAAxB,KAApB;AACA,SAAK5B,MAAL,CAAY0B,cAAZ,CAA2B;AAAEwF,MAAAA,eAAe,eAAOrF,OAAP;AAAjB,KAA3B;AACA,WAAO,KAAKR,YAAL,CAAkBoC,MAAM,CAACC,WAAzB,EAAsCyB,IAAtC,CAA2C,UAACvD,KAAD,EAAW;AAC3D,UAAIwF,KAAK,GAAG,CAAZ;AACAxF,MAAAA,KAAK,CAACU,OAAN,CAAc,UAACuB,IAAD,EAAU;AACtB,YAAMwD,OAAO,GAAG,MAAI,CAAC5G,OAAL,CAAaoD,IAAb,CAAhB;;AACA,YAAIwD,OAAJ,EAAaD,KAAK;AACnB,OAHD;AAIA,UAAME,GAAG,GAAG1F,KAAK,CAAC2F,GAAN,CAAU,MAAI,CAACxD,gBAAf,CAAZ;AACAlC,MAAAA,OAAO,CAACoF,QAAD,CAAP,GAAoB;AAClBE,QAAAA,OAAO,EAAE,KADS;AAElBvF,QAAAA,KAAK,EAAE0F;AAFW,OAApB;;AAIA,MAAA,MAAI,CAACtH,MAAL,CAAY0B,cAAZ,CAA2B;AAAEwF,QAAAA,eAAe,EAAErF;AAAnB,OAA3B;;AAEA,UAAIyD,OAAJ;;AACA,UAAI1D,KAAK,CAACiF,MAAV,EAAkB;AAChBvB,QAAAA,OAAO,GAAG,MAAI,CAACtF,MAAL,CAAY+E,IAAZ,CAAiBQ,IAAjB,CAAsB,aAAtB,EAAqC;AAC7CiC,UAAAA,WAAW,EAAEJ,KADgC;AACzB3D,UAAAA,MAAM,EAAEA,MAAM,CAACZ;AADU,SAArC,CAAV;AAGD,OAJD,MAIO;AACLyC,QAAAA,OAAO,GAAG,MAAI,CAACtF,MAAL,CAAY+E,IAAZ,CAAiBQ,IAAjB,CAAsB,kBAAtB,CAAV;AACD;;AACD,MAAA,MAAI,CAACvF,MAAL,CAAY+E,IAAZ,CAAiBU,IAAjB,CAAsBH,OAAtB;AACD,KAtBM,EAsBJK,KAtBI,CAsBE,UAACC,CAAD,EAAO;AACd,UAAM3C,KAAK,GAAG,MAAI,CAACjD,MAAL,CAAYkD,cAAZ,EAAd;;AACA,UAAMgE,eAAe,gBAAQjE,KAAK,CAACiE,eAAd,CAArB;;AACA,aAAOA,eAAe,CAACD,QAAD,CAAtB;;AACA,MAAA,MAAI,CAACjH,MAAL,CAAY0B,cAAZ,CAA2B;AAAEwF,QAAAA,eAAe,EAAfA;AAAF,OAA3B;;AACA,MAAA,MAAI,CAAC/F,WAAL,CAAiByE,CAAjB;AACD,KA5BM,CAAP;AA6BD,GAjUH;;AAAA,SAmUE7B,gBAnUF,GAmUE,0BAAkBF,IAAlB,EAAwB;AACtB,WAAO3E,cAAc,CAAC;AACpB+E,MAAAA,IAAI,EAAEJ,IADc;AAEpBhB,MAAAA,IAAI,EAAEgB,IAAI,CAAChB,IAAL,IAAagB,IAAI,CAACjB,EAFJ;AAGpBsB,MAAAA,IAAI,EAAEL,IAAI,CAACM;AAHS,KAAD,CAArB;AAKD,GAzUH;;AAAA,SA2UEnD,UA3UF,GA2UE,sBAAc;AAAA;;AACZ,QAAMyG,SAAS,GAAGC,IAAI,CAACC,IAAI,CAACC,SAAL,CAAe;AAAElI,MAAAA,MAAM,EAAEF,SAAS;AAAnB,KAAf,CAAD,CAAtB;AACA,QAAMqI,aAAa,6BAA2BC,YAAY,CAACC,OAA3D;AACA,QAAMC,IAAI,GAAG,KAAK9H,QAAL,CAAc+H,OAAd,CAAsB;AAAEhF,MAAAA,KAAK,EAAEwE,SAAT;AAAoBS,MAAAA,YAAY,EAAEL;AAAlC,KAAtB,CAAb;AAEA,QAAMM,UAAU,GAAGC,MAAM,CAACC,IAAP,CAAYL,IAAZ,EAAkB,QAAlB,CAAnB;;AACA,QAAMM,WAAW,GAAG,SAAdA,WAAc,CAAC1C,CAAD,EAAO;AACzB,UAAI,CAAC,MAAI,CAAC2C,gBAAL,CAAsB3C,CAAC,CAAClG,MAAxB,EAAgC,MAAI,CAACM,MAAL,CAAYC,IAAZ,CAAiBuI,qBAAjD,CAAD,IAA4E5C,CAAC,CAAC5B,MAAF,KAAamE,UAA7F,EAAyG;AACvG,QAAA,MAAI,CAACnI,MAAL,CAAY+E,IAAZ,CAAiBC,GAAjB,2BAA6CY,CAAC,CAAClG,MAA/C,4BAA4E,MAAI,CAACM,MAAL,CAAYC,IAAZ,CAAiBuI,qBAA7F;;AACA;AACD,OAJwB,CAMzB;AACA;;;AACA,UAAMvE,IAAI,GAAG,OAAO2B,CAAC,CAAC3B,IAAT,KAAkB,QAAlB,GAA6B0D,IAAI,CAACc,KAAL,CAAW7C,CAAC,CAAC3B,IAAb,CAA7B,GAAkD2B,CAAC,CAAC3B,IAAjE;;AAEA,UAAI,CAACA,IAAI,CAACyE,KAAV,EAAiB;AACf,QAAA,MAAI,CAAC1I,MAAL,CAAY+E,IAAZ,CAAiBC,GAAjB,CAAqB,wCAArB;;AACA;AACD;;AAEDmD,MAAAA,UAAU,CAACQ,KAAX;AACAP,MAAAA,MAAM,CAACQ,mBAAP,CAA2B,SAA3B,EAAsCN,WAAtC;;AACA,MAAA,MAAI,CAACpI,QAAL,CAAc2I,YAAd,CAA2B5E,IAAI,CAACyE,KAAhC;;AACA,MAAA,MAAI,CAAC3H,cAAL;AACD,KAnBD;;AAoBAqH,IAAAA,MAAM,CAACU,gBAAP,CAAwB,SAAxB,EAAmCR,WAAnC;AACD,GAtWH;;AAAA,SAwWEC,gBAxWF,GAwWE,0BAAkB7I,MAAlB,EAA0BqJ,aAA1B,EAAyC;AACvC,QAAMC,QAAQ,GAAG,SAAXA,QAAW,CAAClD,KAAD,EAAW;AAC1B,UAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC7B,eAAO,IAAImD,MAAJ,OAAenD,KAAf,OAAP;AACD;;AAAC,UAAIA,KAAK,YAAYmD,MAArB,EAA6B;AAC7B,eAAOnD,KAAP;AACD;AACF,KAND;;AAQA,QAAMoD,QAAQ,GAAGC,KAAK,CAACC,OAAN,CAAcL,aAAd,IAA+BA,aAAa,CAACxB,GAAd,CAAkByB,QAAlB,CAA/B,GAA6D,CAACA,QAAQ,CAACD,aAAD,CAAT,CAA9E;AACA,WAAOG,QAAQ,CACZG,MADI,CACG,UAACC,OAAD;AAAA,aAAaA,OAAO,IAAI,IAAxB;AAAA,KADH,EACiC;AADjC,KAEJC,IAFI,CAEC,UAACD,OAAD;AAAA,aAAaA,OAAO,CAACE,IAAR,CAAa9J,MAAb,KAAwB4J,OAAO,CAACE,IAAR,CAAgB9J,MAAhB,OAArC;AAAA,KAFD,CAAP,CAVuC,CAYkC;AAC1E,GArXH;;AAAA,SAuXEyB,WAvXF,GAuXE,qBAAasI,KAAb,EAAoB;AAClB,QAAM1E,IAAI,GAAG,KAAK/E,MAAL,CAAY+E,IAAzB;AACAA,IAAAA,IAAI,CAACC,GAAL,CAASyE,KAAK,CAACC,QAAN,EAAT;;AACA,QAAID,KAAK,CAACE,WAAV,EAAuB;AACrB;AACD;;AACD,QAAMrE,OAAO,GAAGP,IAAI,CAACQ,IAAL,CAAU,gBAAV,CAAhB;AACAR,IAAAA,IAAI,CAACU,IAAL,CAAU;AAAEH,MAAAA,OAAO,EAAPA,OAAF;AAAWsE,MAAAA,OAAO,EAAEH,KAAK,CAACC,QAAN;AAApB,KAAV,EAAkD,OAAlD,EAA2D,IAA3D;AACD,GA/XH;;AAAA,SAiYEtI,YAjYF,GAiYE,sBAAcwE,CAAd,EAAiB;AAAA;;AACf,QAAMiE,SAAS,GAAGjE,CAAC,CAACC,MAAF,CAASiE,YAAT,IAAyBlE,CAAC,CAACC,MAAF,CAASkE,SAAT,GAAqBnE,CAAC,CAACC,MAAF,CAASmE,YAAvD,CAAlB;AACA,QAAMC,IAAI,GAAG,KAAK7H,YAAL,IAAqB,IAAlC;;AAEA,QAAIyH,SAAS,GAAG,EAAZ,IAAkBI,IAAlB,IAA0B,CAAC,KAAKC,iBAApC,EAAuD;AACrD,WAAKhK,QAAL,CAAc6C,IAAd,CAAmBkH,IAAnB,EACG9E,IADH,CACQ,UAAChD,GAAD,EAAS;AAAA,oCACc,MAAI,CAACnC,MAAL,CAAYkD,cAAZ,EADd;AAAA,YACLtB,KADK,yBACLA,KADK;AAAA,YACEC,OADF,yBACEA,OADF;;AAEb,QAAA,MAAI,CAACK,sBAAL,CAA4BC,GAA5B,EAAiCP,KAAjC,EAAwCC,OAAxC;AACD,OAJH,EAIK8D,KAJL,CAIW,KAAKxE,WAJhB,EAKGgE,IALH,CAKQ,YAAM;AAAE,QAAA,MAAI,CAAC+E,iBAAL,GAAyB,KAAzB;AAAgC,OALhD,EADqD,CAMH;;AAElD,WAAKA,iBAAL,GAAyB,IAAzB;AACD;AACF,GA/YH;;AAAA,SAiZE7I,YAjZF,GAiZE,sBAAc4I,IAAd,EAAoBrI,KAApB,EAAkC;AAAA;;AAAA,QAAdA,KAAc;AAAdA,MAAAA,KAAc,GAAN,IAAM;AAAA;;AAChCA,IAAAA,KAAK,GAAGA,KAAK,IAAI,EAAjB;AACA,WAAO,IAAIuI,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,MAAA,MAAI,CAACnK,QAAL,CAAc6C,IAAd,CAAmBkH,IAAnB,EAAyB9E,IAAzB,CAA8B,UAAChD,GAAD,EAAS;AACrCA,QAAAA,GAAG,CAACE,KAAJ,CAAUC,OAAV,CAAkB,UAACC,IAAD,EAAU;AAC1B,cAAI,CAACA,IAAI,CAACC,QAAV,EAAoB;AAClBZ,YAAAA,KAAK,CAACa,IAAN,CAAWF,IAAX;AACD,WAFD,MAEO;AACL,YAAA,MAAI,CAACyE,SAAL,CAAezE,IAAf;AACD;AACF,SAND;AAOA,YAAM+H,SAAS,GAAGnI,GAAG,CAACC,YAAJ,IAAoB,IAAtC;;AACA,YAAIkI,SAAJ,EAAe;AACb,iBAAO,MAAI,CAACjJ,YAAL,CAAkBiJ,SAAlB,EAA6B1I,KAA7B,EACJuD,IADI,CACC,UAACvD,KAAD;AAAA,mBAAWwI,OAAO,CAACxI,KAAD,CAAlB;AAAA,WADD,EAEJ+D,KAFI,CAEE,UAAAC,CAAC;AAAA,mBAAIyE,MAAM,CAACzE,CAAD,CAAV;AAAA,WAFH,CAAP;AAGD;;AACD,eAAOwE,OAAO,CAACxI,KAAD,CAAd;AACD,OAfD,EAeG+D,KAfH,CAeS,UAAAC,CAAC;AAAA,eAAIyE,MAAM,CAACzE,CAAD,CAAV;AAAA,OAfV;AAgBD,KAjBM,CAAP;AAkBD,GAraH;;AAAA,SAuaEtE,WAvaF,GAuaE,uBAAe;AAAA;;AAAA,gCACgB,KAAKtB,MAAL,CAAYkD,cAAZ,EADhB;AAAA,QACLqH,gBADK,yBACLA,gBADK;;AAEb,QAAMC,QAAQ,GAAGD,gBAAgB,CAAChD,GAAjB,CAAqB,UAAC1D,IAAD,EAAU;AAC9C,UAAIA,IAAI,CAACrB,QAAT,EAAmB;AACjB,eAAO,MAAI,CAACwE,SAAL,CAAenD,IAAf,CAAP;AACD;;AACD,aAAO,MAAI,CAACpD,OAAL,CAAaoD,IAAb,CAAP;AACD,KALgB,CAAjB;;AAOA,SAAK1D,cAAL,CAAoB2C,aAApB,CAAkCqH,OAAO,CAACM,GAAR,CAAYD,QAAZ,CAAlC,EAAyD,YAAM;AAC7D,MAAA,MAAI,CAAChJ,cAAL;AACD,KAFD,EAEG,YAAM,CAAE,CAFX;AAGD,GAnbH;;AAAA,SAqbED,aArbF,GAqbE,yBAAiB;AACf,SAAKC,cAAL;AAEA,QAAMkJ,SAAS,GAAG,KAAK1K,MAAL,CAAY+E,IAAZ,CAAiB4F,SAAjB,CAA2B,WAA3B,CAAlB;AACA,QAAID,SAAJ,EAAeA,SAAS,CAACE,aAAV;AAChB,GA1bH;;AAAA,SA4bEpJ,cA5bF,GA4bE,0BAAkB;AAChB,SAAKxB,MAAL,CAAY0B,cAAZ,CAA2B;AAAE6I,MAAAA,gBAAgB,EAAE;AAApB,KAA3B;AACD,GA9bH;;AAAA,SAgcE9I,MAhcF,GAgcE,gBAAQwB,KAAR,EAAe4H,WAAf,EAAiC;AAAA,QAAlBA,WAAkB;AAAlBA,MAAAA,WAAkB,GAAJ,EAAI;AAAA;;AAAA,iCACW,KAAK7K,MAAL,CAAYkD,cAAZ,EADX;AAAA,QACvBvB,aADuB,0BACvBA,aADuB;AAAA,QACRe,cADQ,0BACRA,cADQ;;AAE/B,QAAI,CAACA,cAAL,EAAqB;AACnB,WAAK3B,cAAL;AACD,KAJ8B,CAM/B;AACA;;;AACA,QAAI,KAAKf,MAAL,CAAYkD,cAAZ,GAA6BiE,OAAjC,EAA0C;AACxC,aACE,EAAC,YAAD;AAAc,QAAA,SAAS,EAAE,KAAK3F;AAA9B,SACE,EAAC,UAAD;AAAY,QAAA,IAAI,EAAE,KAAKxB,MAAL,CAAY+E,IAAZ,CAAiBQ;AAAnC,QADF,CADF;AAKD;;AAED,QAAI,CAAC5D,aAAL,EAAoB;AAClB,aACE,EAAC,YAAD;AAAc,QAAA,SAAS,EAAE,KAAKH;AAA9B,SACE,EAAC,QAAD;AACE,QAAA,UAAU,EAAE,KAAKxB,MAAL,CAAYuD,KAD1B;AAEE,QAAA,UAAU,EAAE,KAAKvD,MAAL,CAAY8K,IAF1B;AAGE,QAAA,UAAU,EAAE,KAAK9J,UAHnB;AAIE,QAAA,IAAI,EAAE,KAAKhB,MAAL,CAAY+E,IAAZ,CAAiBQ,IAJzB;AAKE,QAAA,SAAS,EAAE,KAAKvF,MAAL,CAAY+E,IAAZ,CAAiBgG;AAL9B,QADF,CADF;AAWD;;AAED,QAAMC,iBAAiB,gBAAQ,KAAK/K,IAAb,EAAsB4K,WAAtB,CAAvB;;AACA,QAAMI,WAAW,GAAG;AAClBzK,MAAAA,eAAe,EAAEwK,iBAAiB,CAACxK,eADjB;AAElBI,MAAAA,SAAS,EAAE,KAAKA,SAFE;AAGlBkB,MAAAA,WAAW,EAAE,KAAK9B,MAAL,CAAYkD,cAAZ,GAA6BpB,WAHxB;AAIlBoJ,MAAAA,UAAU,EAAE,KAAKlL,MAAL,CAAY8K,IAJN;AAKlBvH,MAAAA,KAAK,EAAE,KAAKvD,MAAL,CAAYuD,KALD;AAMlBzC,MAAAA,MAAM,EAAE,KAAKA,MANK;AAOlB0C,MAAAA,QAAQ,EAAE,KAAKA,QAPG;AAQlB+B,MAAAA,IAAI,EAAE,KAAKvF,MAAL,CAAY+E,IAAZ,CAAiBQ;AARL,KAApB;;AAWA,QAAM4F,YAAY,gBACb,KAAKnL,MAAL,CAAYkD,cAAZ,EADa;AAEhBM,MAAAA,QAAQ,EAAE,KAAKA,QAFC;AAGhB3C,MAAAA,aAAa,EAAE,KAAKA,aAHJ;AAIhBD,MAAAA,SAAS,EAAE,KAAKA,SAJA;AAKhBwK,MAAAA,WAAW,EAAE,KAAKjL,cAAL,CAAoBiL,WALjB;AAMhBzK,MAAAA,WAAW,EAAE,KAAKA,WANF;AAOhBM,MAAAA,WAAW,EAAE,KAAKA,WAPF;AAQhBC,MAAAA,UAAU,EAAE,KAAKA,UARD;AAShBJ,MAAAA,MAAM,EAAE,KAAKA,MATG;AAUhBuK,MAAAA,SAAS,EAAE,KAAKlL,cAAL,CAAoBkL,SAVf;AAWhBC,MAAAA,cAAc,EAAE,KAAKnL,cAAL,CAAoBmL,cAXpB;AAYhBlK,MAAAA,YAAY,EAAE,KAAKA,YAZH;AAahBC,MAAAA,YAAY,EAAE,KAAKA,YAbH;AAchBkK,MAAAA,IAAI,EAAE,KAAKjK,WAdK;AAehBkK,MAAAA,MAAM,EAAE,KAAKjK,aAfG;AAgBhBkK,MAAAA,eAAe,EAAE1M,MAAM,CAACkM,WAAD,CAhBP;AAiBhB1H,MAAAA,KAAK,EAAE,KAAKvD,MAAL,CAAYuD,KAjBH;AAkBhBlD,MAAAA,QAAQ,EAAE2K,iBAAiB,CAAC3K,QAlBZ;AAmBhBC,MAAAA,UAAU,EAAE0K,iBAAiB,CAAC1K,UAnBd;AAoBhBC,MAAAA,UAAU,EAAEyK,iBAAiB,CAACzK,UApBd;AAqBhBC,MAAAA,eAAe,EAAEwK,iBAAiB,CAACxK,eArBnB;AAsBhB0K,MAAAA,UAAU,EAAE,KAAKlL,MAAL,CAAY8K,IAtBR;AAuBhBvF,MAAAA,IAAI,EAAE,KAAKvF,MAAL,CAAY+E,IAAZ,CAAiBQ,IAvBP;AAwBhBmG,MAAAA,SAAS,EAAE,KAAK1L,MAAL,CAAY+E,IAAZ,CAAiB4G,QAAjB,EAxBK;AAyBhBC,MAAAA,oBAAoB,EAAE,KAAK5L,MAAL,CAAY+E,IAAZ,CAAiB6G;AAzBvB,MAAlB;;AA4BA,WACE,EAAC,YAAD;AAAc,MAAA,SAAS,EAAE,KAAKpK;AAA9B,OACE,EAAC,OAAD,EAAa2J,YAAb,CADF,CADF;AAKD,GA3gBH;;AAAA;AAAA,YACSpD,OADT","sourcesContent":["const { h } = require('preact')\nconst AuthView = require('./AuthView')\nconst Header = require('./Header')\nconst Browser = require('../Browser')\nconst LoaderView = require('../Loader')\nconst generateFileID = require('@uppy/utils/lib/generateFileID')\nconst getFileType = require('@uppy/utils/lib/getFileType')\nconst findIndex = require('@uppy/utils/lib/findIndex')\nconst isPreviewSupported = require('@uppy/utils/lib/isPreviewSupported')\nconst SharedHandler = require('../SharedHandler')\nconst CloseWrapper = require('../CloseWrapper')\n\n// location.origin does not exist in IE\nfunction getOrigin () {\n  if ('origin' in location) {\n    return location.origin // eslint-disable-line compat/compat\n  }\n  return `${location.protocol}//${location.hostname}${location.port ? `:${location.port}` : ''}`\n}\n\n/**\n * Class to easily generate generic views for Provider plugins\n */\nmodule.exports = class ProviderView {\n  static VERSION = require('../../package.json').version\n\n  /**\n   * @param {object} plugin instance of the plugin\n   * @param {object} opts\n   */\n  constructor (plugin, opts) {\n    this.plugin = plugin\n    this.provider = opts.provider\n    this._sharedHandler = new SharedHandler(plugin)\n\n    // set default options\n    const defaultOptions = {\n      viewType: 'list',\n      showTitles: true,\n      showFilter: true,\n      showBreadcrumbs: true,\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    // Logic\n    this.addFile = this.addFile.bind(this)\n    this.filterQuery = this.filterQuery.bind(this)\n    this.getFolder = this.getFolder.bind(this)\n    this.getNextFolder = this.getNextFolder.bind(this)\n    this.logout = this.logout.bind(this)\n    this.preFirstRender = this.preFirstRender.bind(this)\n    this.handleAuth = this.handleAuth.bind(this)\n    this.sortByTitle = this.sortByTitle.bind(this)\n    this.sortByDate = this.sortByDate.bind(this)\n    this.handleError = this.handleError.bind(this)\n    this.handleScroll = this.handleScroll.bind(this)\n    this.listAllFiles = this.listAllFiles.bind(this)\n    this.donePicking = this.donePicking.bind(this)\n    this.cancelPicking = this.cancelPicking.bind(this)\n    this.clearSelection = this.clearSelection.bind(this)\n\n    // Visual\n    this.render = this.render.bind(this)\n\n    this.clearSelection()\n\n    // Set default state for the plugin\n    this.plugin.setPluginState({\n      authenticated: false,\n      files: [],\n      folders: [],\n      directories: [],\n      filterInput: '',\n      isSearchVisible: false,\n    })\n  }\n\n  tearDown () {\n    // Nothing.\n  }\n\n  _updateFilesAndFolders (res, files, folders) {\n    this.nextPagePath = res.nextPagePath\n    res.items.forEach((item) => {\n      if (item.isFolder) {\n        folders.push(item)\n      } else {\n        files.push(item)\n      }\n    })\n\n    this.plugin.setPluginState({ folders, files })\n  }\n\n  /**\n   * Called only the first time the provider view is rendered.\n   * Kind of like an init function.\n   */\n  preFirstRender () {\n    this.plugin.setPluginState({ didFirstRender: true })\n    this.plugin.onFirstRender()\n  }\n\n  /**\n   * Based on folder ID, fetch a new folder and update it to state\n   *\n   * @param  {string} id Folder id\n   * @returns {Promise}   Folders/files in folder\n   */\n  getFolder (id, name) {\n    return this._sharedHandler.loaderWrapper(\n      this.provider.list(id),\n      (res) => {\n        const folders = []\n        const files = []\n        let updatedDirectories\n\n        const state = this.plugin.getPluginState()\n        const index = findIndex(state.directories, (dir) => id === dir.id)\n\n        if (index !== -1) {\n          updatedDirectories = state.directories.slice(0, index + 1)\n        } else {\n          updatedDirectories = state.directories.concat([{ id, title: name }])\n        }\n\n        this.username = res.username || this.username\n        this._updateFilesAndFolders(res, files, folders)\n        this.plugin.setPluginState({ directories: updatedDirectories })\n      },\n      this.handleError\n    )\n  }\n\n  /**\n   * Fetches new folder\n   *\n   * @param  {object} folder\n   */\n  getNextFolder (folder) {\n    this.getFolder(folder.requestPath, folder.name)\n    this.lastCheckbox = undefined\n  }\n\n  addFile (file) {\n    const tagFile = {\n      id: this.providerFileToId(file),\n      source: this.plugin.id,\n      data: file,\n      name: file.name || file.id,\n      type: file.mimeType,\n      isRemote: true,\n      body: {\n        fileId: file.id,\n      },\n      remote: {\n        companionUrl: this.plugin.opts.companionUrl,\n        url: `${this.provider.fileUrl(file.requestPath)}`,\n        body: {\n          fileId: file.id,\n        },\n        providerOptions: this.provider.opts,\n      },\n    }\n\n    const fileType = getFileType(tagFile)\n    // TODO Should we just always use the thumbnail URL if it exists?\n    if (fileType && isPreviewSupported(fileType)) {\n      tagFile.preview = file.thumbnail\n    }\n    this.plugin.uppy.log('Adding remote file')\n    try {\n      this.plugin.uppy.addFile(tagFile)\n      return true\n    } catch (err) {\n      if (!err.isRestriction) {\n        this.plugin.uppy.log(err)\n      }\n      return false\n    }\n  }\n\n  /**\n   * Removes session token on client side.\n   */\n  logout () {\n    this.provider.logout()\n      .then((res) => {\n        if (res.ok) {\n          if (!res.revoked) {\n            const message = this.plugin.uppy.i18n('companionUnauthorizeHint', {\n              provider: this.plugin.title,\n              url: res.manual_revoke_url,\n            })\n            this.plugin.uppy.info(message, 'info', 7000)\n          }\n\n          const newState = {\n            authenticated: false,\n            files: [],\n            folders: [],\n            directories: [],\n          }\n          this.plugin.setPluginState(newState)\n        }\n      }).catch(this.handleError)\n  }\n\n  filterQuery (e) {\n    const state = this.plugin.getPluginState()\n    this.plugin.setPluginState({ ...state, filterInput: e ? e.target.value : '' })\n  }\n\n  sortByTitle () {\n    const state = { ...this.plugin.getPluginState() }\n    const { files, folders, sorting } = state\n\n    const sortedFiles = files.sort((fileA, fileB) => {\n      if (sorting === 'titleDescending') {\n        return fileB.name.localeCompare(fileA.name)\n      }\n      return fileA.name.localeCompare(fileB.name)\n    })\n\n    const sortedFolders = folders.sort((folderA, folderB) => {\n      if (sorting === 'titleDescending') {\n        return folderB.name.localeCompare(folderA.name)\n      }\n      return folderA.name.localeCompare(folderB.name)\n    })\n\n    this.plugin.setPluginState({\n      ...state,\n      files: sortedFiles,\n      folders: sortedFolders,\n      sorting: (sorting === 'titleDescending') ? 'titleAscending' : 'titleDescending',\n    })\n  }\n\n  sortByDate () {\n    const state = { ...this.plugin.getPluginState() }\n    const { files, folders, sorting } = state\n\n    const sortedFiles = files.sort((fileA, fileB) => {\n      const a = new Date(fileA.modifiedDate)\n      const b = new Date(fileB.modifiedDate)\n\n      if (sorting === 'dateDescending') {\n        return a > b ? -1 : a < b ? 1 : 0\n      }\n      return a > b ? 1 : a < b ? -1 : 0\n    })\n\n    const sortedFolders = folders.sort((folderA, folderB) => {\n      const a = new Date(folderA.modifiedDate)\n      const b = new Date(folderB.modifiedDate)\n\n      if (sorting === 'dateDescending') {\n        return a > b ? -1 : a < b ? 1 : 0\n      }\n\n      return a > b ? 1 : a < b ? -1 : 0\n    })\n\n    this.plugin.setPluginState({\n      ...state,\n      files: sortedFiles,\n      folders: sortedFolders,\n      sorting: (sorting === 'dateDescending') ? 'dateAscending' : 'dateDescending',\n    })\n  }\n\n  sortBySize () {\n    const state = { ...this.plugin.getPluginState() }\n    const { files, sorting } = state\n\n    // check that plugin supports file sizes\n    if (!files.length || !this.plugin.getItemData(files[0]).size) {\n      return\n    }\n\n    const sortedFiles = files.sort((fileA, fileB) => {\n      const a = fileA.size\n      const b = fileB.size\n\n      if (sorting === 'sizeDescending') {\n        return a > b ? -1 : a < b ? 1 : 0\n      }\n      return a > b ? 1 : a < b ? -1 : 0\n    })\n\n    this.plugin.setPluginState({\n      ...state,\n      files: sortedFiles,\n      sorting: (sorting === 'sizeDescending') ? 'sizeAscending' : 'sizeDescending',\n    })\n  }\n\n  /**\n   * Adds all files found inside of specified folder.\n   *\n   * Uses separated state while folder contents are being fetched and\n   * mantains list of selected folders, which are separated from files.\n   */\n  addFolder (folder) {\n    const folderId = this.providerFileToId(folder)\n    const state = this.plugin.getPluginState()\n    const folders = { ...state.selectedFolders }\n    if (folderId in folders && folders[folderId].loading) {\n      return\n    }\n    folders[folderId] = { loading: true, files: [] }\n    this.plugin.setPluginState({ selectedFolders: { ...folders } })\n    return this.listAllFiles(folder.requestPath).then((files) => {\n      let count = 0\n      files.forEach((file) => {\n        const success = this.addFile(file)\n        if (success) count++\n      })\n      const ids = files.map(this.providerFileToId)\n      folders[folderId] = {\n        loading: false,\n        files: ids,\n      }\n      this.plugin.setPluginState({ selectedFolders: folders })\n\n      let message\n      if (files.length) {\n        message = this.plugin.uppy.i18n('folderAdded', {\n          smart_count: count, folder: folder.name,\n        })\n      } else {\n        message = this.plugin.uppy.i18n('emptyFolderAdded')\n      }\n      this.plugin.uppy.info(message)\n    }).catch((e) => {\n      const state = this.plugin.getPluginState()\n      const selectedFolders = { ...state.selectedFolders }\n      delete selectedFolders[folderId]\n      this.plugin.setPluginState({ selectedFolders })\n      this.handleError(e)\n    })\n  }\n\n  providerFileToId (file) {\n    return generateFileID({\n      data: file,\n      name: file.name || file.id,\n      type: file.mimeType,\n    })\n  }\n\n  handleAuth () {\n    const authState = btoa(JSON.stringify({ origin: getOrigin() }))\n    const clientVersion = `@uppy/provider-views=${ProviderView.VERSION}`\n    const link = this.provider.authUrl({ state: authState, uppyVersions: clientVersion })\n\n    const authWindow = window.open(link, '_blank')\n    const handleToken = (e) => {\n      if (!this._isOriginAllowed(e.origin, this.plugin.opts.companionAllowedHosts) || e.source !== authWindow) {\n        this.plugin.uppy.log(`rejecting event from ${e.origin} vs allowed pattern ${this.plugin.opts.companionAllowedHosts}`)\n        return\n      }\n\n      // Check if it's a string before doing the JSON.parse to maintain support\n      // for older Companion versions that used object references\n      const data = typeof e.data === 'string' ? JSON.parse(e.data) : e.data\n\n      if (!data.token) {\n        this.plugin.uppy.log('did not receive token from auth window')\n        return\n      }\n\n      authWindow.close()\n      window.removeEventListener('message', handleToken)\n      this.provider.setAuthToken(data.token)\n      this.preFirstRender()\n    }\n    window.addEventListener('message', handleToken)\n  }\n\n  _isOriginAllowed (origin, allowedOrigin) {\n    const getRegex = (value) => {\n      if (typeof value === 'string') {\n        return new RegExp(`^${value}$`)\n      } if (value instanceof RegExp) {\n        return value\n      }\n    }\n\n    const patterns = Array.isArray(allowedOrigin) ? allowedOrigin.map(getRegex) : [getRegex(allowedOrigin)]\n    return patterns\n      .filter((pattern) => pattern != null) // loose comparison to catch undefined\n      .some((pattern) => pattern.test(origin) || pattern.test(`${origin}/`)) // allowing for trailing '/'\n  }\n\n  handleError (error) {\n    const uppy = this.plugin.uppy\n    uppy.log(error.toString())\n    if (error.isAuthError) {\n      return\n    }\n    const message = uppy.i18n('companionError')\n    uppy.info({ message, details: error.toString() }, 'error', 5000)\n  }\n\n  handleScroll (e) {\n    const scrollPos = e.target.scrollHeight - (e.target.scrollTop + e.target.offsetHeight)\n    const path = this.nextPagePath || null\n\n    if (scrollPos < 50 && path && !this._isHandlingScroll) {\n      this.provider.list(path)\n        .then((res) => {\n          const { files, folders } = this.plugin.getPluginState()\n          this._updateFilesAndFolders(res, files, folders)\n        }).catch(this.handleError)\n        .then(() => { this._isHandlingScroll = false }) // always called\n\n      this._isHandlingScroll = true\n    }\n  }\n\n  listAllFiles (path, files = null) {\n    files = files || []\n    return new Promise((resolve, reject) => {\n      this.provider.list(path).then((res) => {\n        res.items.forEach((item) => {\n          if (!item.isFolder) {\n            files.push(item)\n          } else {\n            this.addFolder(item)\n          }\n        })\n        const moreFiles = res.nextPagePath || null\n        if (moreFiles) {\n          return this.listAllFiles(moreFiles, files)\n            .then((files) => resolve(files))\n            .catch(e => reject(e))\n        }\n        return resolve(files)\n      }).catch(e => reject(e))\n    })\n  }\n\n  donePicking () {\n    const { currentSelection } = this.plugin.getPluginState()\n    const promises = currentSelection.map((file) => {\n      if (file.isFolder) {\n        return this.addFolder(file)\n      }\n      return this.addFile(file)\n    })\n\n    this._sharedHandler.loaderWrapper(Promise.all(promises), () => {\n      this.clearSelection()\n    }, () => {})\n  }\n\n  cancelPicking () {\n    this.clearSelection()\n\n    const dashboard = this.plugin.uppy.getPlugin('Dashboard')\n    if (dashboard) dashboard.hideAllPanels()\n  }\n\n  clearSelection () {\n    this.plugin.setPluginState({ currentSelection: [] })\n  }\n\n  render (state, viewOptions = {}) {\n    const { authenticated, didFirstRender } = this.plugin.getPluginState()\n    if (!didFirstRender) {\n      this.preFirstRender()\n    }\n\n    // reload pluginState for \"loading\" attribute because it might\n    // have changed above.\n    if (this.plugin.getPluginState().loading) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <LoaderView i18n={this.plugin.uppy.i18n} />\n        </CloseWrapper>\n      )\n    }\n\n    if (!authenticated) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <AuthView\n            pluginName={this.plugin.title}\n            pluginIcon={this.plugin.icon}\n            handleAuth={this.handleAuth}\n            i18n={this.plugin.uppy.i18n}\n            i18nArray={this.plugin.uppy.i18nArray}\n          />\n        </CloseWrapper>\n      )\n    }\n\n    const targetViewOptions = { ...this.opts, ...viewOptions }\n    const headerProps = {\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      getFolder: this.getFolder,\n      directories: this.plugin.getPluginState().directories,\n      pluginIcon: this.plugin.icon,\n      title: this.plugin.title,\n      logout: this.logout,\n      username: this.username,\n      i18n: this.plugin.uppy.i18n,\n    }\n\n    const browserProps = {\n      ...this.plugin.getPluginState(),\n      username: this.username,\n      getNextFolder: this.getNextFolder,\n      getFolder: this.getFolder,\n      filterItems: this._sharedHandler.filterItems,\n      filterQuery: this.filterQuery,\n      sortByTitle: this.sortByTitle,\n      sortByDate: this.sortByDate,\n      logout: this.logout,\n      isChecked: this._sharedHandler.isChecked,\n      toggleCheckbox: this._sharedHandler.toggleCheckbox,\n      handleScroll: this.handleScroll,\n      listAllFiles: this.listAllFiles,\n      done: this.donePicking,\n      cancel: this.cancelPicking,\n      headerComponent: Header(headerProps),\n      title: this.plugin.title,\n      viewType: targetViewOptions.viewType,\n      showTitles: targetViewOptions.showTitles,\n      showFilter: targetViewOptions.showFilter,\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      pluginIcon: this.plugin.icon,\n      i18n: this.plugin.uppy.i18n,\n      uppyFiles: this.plugin.uppy.getFiles(),\n      validateRestrictions: this.plugin.uppy.validateRestrictions,\n    }\n\n    return (\n      <CloseWrapper onUnmount={this.clearSelection}>\n        <Browser {...browserProps} />\n      </CloseWrapper>\n    )\n  }\n}\n"]}